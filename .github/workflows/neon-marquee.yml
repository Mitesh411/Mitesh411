name: Neon Marquee Contributions

on:
  schedule:
    - cron: "0 */12 * * *"
  workflow_dispatch:

concurrency:
  group: neon-marquee
  cancel-in-progress: true

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash

    steps:
      - uses: actions/checkout@v4

      - name: Generate Neon Marquee SVG
        run: |
          mkdir -p dist
          # fail early on network error, follow redirects, be quiet except on error
          curl --fail --show-error --silent -L -o dist/contrib.svg "https://ghchart.rshah.org/${{ github.repository_owner }}"

          cat > dist/neon-marquee.svg <<'SVG_HEADER'
          <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="220">

          <style>
          .text {
            font: bold 28px monospace;
            fill: #39ff14;
            filter: drop-shadow(0 0 6px #39ff14) drop-shadow(0 0 12px #39ff14);
          }

          .marquee {
            animation: scroll 12s linear infinite;
          }

          @keyframes scroll {
            from { transform: translateX(100%); }
            to { transform: translateX(-100%); }
          }
          </style>

          <g class="marquee">
            <text x="0" y="35" class="text">
              Mitesh411 • GitHub Contributions • Mitesh411 • GitHub Contributions
            </text>

            <g transform="translate(0, 55)">
          SVG_HEADER

          # Remove XML declaration and DOCTYPE from contrib.svg and append
          sed -e 's/<?xml[^>]*>//g' -e 's/<!DOCTYPE[^>]*>//g' dist/contrib.svg >> dist/neon-marquee.svg

          cat >> dist/neon-marquee.svg <<'SVG_FOOTER'
            </g>
          </g>

          </svg>
          SVG_FOOTER

      - name: Push to output branch
        uses: crazy-max/ghaction-github-pages@v3
        with:
          target_branch: output
          build_dir: dist
          create_branch: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
